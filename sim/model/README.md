# 2-dimensional convolution model

Это модель двумерного свёрточного слоя, который обычно используется в свёрточных нейронных сетях.

Реализовано только перемножение 3-мерных тензоров (матриц).
Перемножение реализовано "в глубину", то есть каждый 2-мерный слайс исходного тензора перемножается операцией двумерной свёртки с каждым слайсом ядра свёртки.
Результирующий тензор имеет глубину равную произведению глубин исходного тензора и ядра свёртки.

Итерация свёртки выполняется в порядке `tenz[0]*kernel[0], tenz[0]*kernel[1], tenz[1]*kernel[0], ...`.
Результирующий тензор организуется в памяти в том же порядке.

Слайс - 2-мерный тензор (матрица), к которому применяется свёртка.

Реализованный интерфейс:

```c
    void npu_model( int* matrix_1, int* matrix_2, int* matrix_3,
                    int size_1[N], int size_2[N], int size_3[N],
                    int zp_1, int zp_2, int zp_3,
                    int bias, int scale, int shift);
```

Для применения только 2-мерной свёртки ***над двумерными матрицами***, без функции активации, сдвигов и пр., приемняется  функция `convolve_2d`:

```c
    void convolve_2d(int* matrix_1, int* matrix_2, int* matrix_3, int size_1[2], int size_2[2], int size_3[2]);
```

Для применения свёртки над 3-мерным тензором, применяется функция `convolve`:

```c
    void convolve(int* matrix_1, int* matrix_2, int* matrix_3, int size_1[N], int size_2[N], int size_3[N]);
```

Здесь:

- `matrix_1` - тензор, к которому применяется операция свёртки
- `matrix_2` - ядро свёртки
- `matrix_3` - результирующий тензор
- `size_1` - массив размеров исходного тензора. Для N-мерного тензора содержит N значений
- `size_2` - массив размеров ядра свёртки. Для N-мерного тензора содержит N значений
- `size_3` - массив размеров результирующего тензора. Для N-мерного тензора содержит N значений
- `zp_*` - точки нуля для соответствующих тензоров
- `bias` - сдвиг, который применяют к результирующему тензору
- `scale` - множитель результата свёртки
- `shift` - сдвиг, который применяют к результату свёртки

Аргументы `bias`, `scale`, `shift` берутся из CSR.

Все `size_*` для N-мерного тензора содержат N значений.
Для 2-мерных тензоров, `size_*` имеет вид `[M, N]`, где `M` - число строк, `N` - число столбцов.
Для 3-мерных тензоров, `size_*` имеет вид `[M, N, L]`, где `M` - число строк, `N` - число столбцов, `L` - число слайсов (глубина).

N-мерный тензор представлен в памяти следующим образом:

- Расположение в памяти сначала по слайсам, потом по строкам
- Элементу слайса \[0, 0\] соответствует наименьший адрес

## TODO

- [ ] Добавить проверки на размер результирующей матрицы
